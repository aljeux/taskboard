
CREATE TABLE plugin_taskboard (
        taskboard_id SERIAL primary key,
	group_id integer  REFERENCES groups(group_id) ON DELETE CASCADE,
	key_field_alias text NOT NULL COMMENT 'Alias of extra field, used as a key for columns (tasks are spread by columns according to the value of this field). E.g., resolution.',
	filter_field_alias text COMMENT 'Drop-down filter by this field is shown if specified. E.g., sprint or release.',
	estimated_cost_field_alias text COMMENT 'Used for cost calculations together with remaining_cost_field_alias if specified',
	remaining_cost_field_alias text COMMENT 'Used for cost calculations together with estimated_cost_field_alias if specified'
) COMMENT 'Taskboard';

CREATE TABLE plugin_taskboard_trackers (
        taskboard_id integer REFERENCES plugin_taskboards(taskboard_id) ON DELETE CASCADE,
        group_artifact_id integer COMMENT 'Reference to the linked tracker',
        card_background_color text COMMENT 'User can specify different background color for tasks, linked to different trackers',
	PRIMARY KEY (taskboard_id, group_artifact_id)
) COMMENT 'Trackers, linked to the task board';

CREATE TABLE plugin_taskboard_columns (
        taskboard_column_id SERIAL primary key,
        taskboard_id integer REFERENCES plugin_taskboards(taskboard_id) ON DELETE CASCADE, 
	title text NOT NULL COMMENT 'Name of the column',
        title_color text,
        title_background_color text,
	order integer NOT NULL 'Order or the column (from left to the right)',
	max_tasks integer 'Optional maximum number of allowed tasks in the column'
) COMMENT 'Task board columns configuraton';

CREATE TABLE plugin_taskboard_columns_elements (
        taskboard_column_value_id SERIAL primary key,
        taskboard_column_id integer REFERENCES plugin_taskboards_columns( taskboard_column_id ) ON DELETE CASCADE, 
        element_id integer NOT NULL 
) COMMENT 'Key extra field elemens, available for particular column';

-- Task, having any element, can be accepted, if there no sources specified
-- possible set rules:
-- resolution = 'Fixed' (alias = element_name, for extra fields, having elements)
-- remaining_estimated_cost = 0 (alias = value, for extra fields, using values ) 
--
CREATE TABLE plugin_taskboard_columns_sources (
        taskboard_column_source_id SERIAL primary key,
        target_taskboard_column_id integer NOT NULL REFERENCES plugin_taskboards_columns(plugin_taskboard_id) ON DELETE CASCADE,
        source_taskboard_column_id integer REFERENCES plugin_taskboards_columns(plugin_taskboard_id) ON DELETE CASCADE,
	alert text COMMENT 'Optional alert text when task is dropen into the column',
	autoassign integer NOT NULL DEFAULT 0 COMMENT 'if 1 - autoassign current user to the task when droped from source to the target column',
	set_rules text COMMENT 'Optional SET rules - we can automatically assign value to some fields when task is dropped from the source to the target column'
) COMMENT 'Rules for different sources when dropen on the target column';
